(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{1981:(e,s,a)=>{Promise.resolve().then(a.bind(a,2990))},2383:()=>{},2990:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>R});var l=a(5155),r=a(2115),t=a(5695),n=a(3925),i=a(6643),c=a(8482),d=a(7168),o=a(9852),x=a(7655),m=a(3999);let u=r.forwardRef((e,s)=>{let{className:a,children:r,...t}=e;return(0,l.jsxs)(x.bL,{ref:s,className:(0,m.cn)("relative overflow-hidden",a),...t,children:[(0,l.jsx)(x.LM,{className:"h-full w-full rounded-[inherit]",children:r}),(0,l.jsx)(h,{}),(0,l.jsx)(x.OK,{})]})});u.displayName=x.bL.displayName;let h=r.forwardRef((e,s)=>{let{className:a,orientation:r="vertical",...t}=e;return(0,l.jsx)(x.VM,{ref:s,orientation:r,className:(0,m.cn)("flex touch-none select-none transition-colors","vertical"===r&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===r&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...t,children:(0,l.jsx)(x.lr,{className:"relative flex-1 rounded-full bg-border"})})});h.displayName=x.VM.displayName;var f=a(9026),p=a(8145),y=a(4213),j=a(5112),w=a(7434),v=a(4261),b=a(7924),g=a(3786),N=a(5657),k=a(2713),_=a(1007),q=a(2486);let A=e=>{var s;let a="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===a.length&&(null==(s=a.pop())?void 0:s.split(";").shift())||null},S=e=>{document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;")};function R(){var e,s;let[a,x]=(0,r.useState)([]),[m,h]=(0,r.useState)(""),[R,E]=(0,r.useState)(!1),[C,L]=(0,r.useState)(""),[T,D]=(0,r.useState)(null),[U,I]=(0,r.useState)("chat"),[O,B]=(0,r.useState)(null),F=(0,r.useRef)(null),M=(0,t.useRouter)();(0,r.useEffect)(()=>{if(!A("access_token"))return void M.push("/");Z(),x([{id:"welcome",content:"Hello! I'm your Partners8 AI assistant. I can help you with both general questions and real estate data analysis. Try asking me about property data, or just chat with me about anything!",sender:"bot",timestamp:new Date}])},[M]),(0,r.useEffect)(()=>{Q()},[a]);let Q=()=>{var e;null==(e=F.current)||e.scrollIntoView({behavior:"smooth"})},W=()=>{S("access_token"),S("username"),S("user_role"),S("user_id"),S("user_email")},Z=async()=>{try{let e=A("access_token"),s=await fetch("http://localhost:8000/database/info",{headers:{Authorization:"Bearer ".concat(e)}});if(s.ok){let e=await s.json();B(e)}else 401===s.status&&(W(),M.push("/"))}catch(e){console.error("Failed to load database info:",e)}},$=async e=>{if(e.preventDefault(),!m.trim()||R)return;let s={id:Date.now().toString(),content:m,sender:"user",timestamp:new Date};x(e=>[...e,s]),h(""),E(!0),L("");try{let e=A("access_token"),s=await fetch("http://localhost:8000/chat",{method:"POST",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({message:m,session_id:T})});if(s.ok){let e=await s.json();T||D(e.session_id);let a="",l=e.response;if("data_query"===e.query_type&&e.response.includes("**Data Analysis Results:**")){let s=e.response.split("**Data Analysis Results:**");s.length>1&&(l=a=s[1].split("**Found")[0].trim().replace(/\n\n/g," ").trim())}let r={id:(Date.now()+1).toString(),content:l,sender:"bot",timestamp:new Date,isGrounded:e.is_grounded,sources:e.sources,sessionId:e.session_id,queryType:e.query_type,sqlQuery:e.sql_query,queryResults:e.query_results,summary:a||l};x(e=>[...e,r])}else if(401===s.status)W(),M.push("/");else{let e=await s.json();L(e.detail||"Failed to send message")}}catch(e){L("Network error. Please try again.")}finally{E(!1)}},z=function(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"csv";if(!e||0===e.length)return;let l=Object.keys(e[0]);if("csv"===a){let a=new Blob([[l.join(","),...e.map(e=>l.map(s=>{let a=e[s];return"string"==typeof a&&(a.includes(",")||a.includes('"'))?'"'.concat(a.replace(/"/g,'""'),'"'):a||""}).join(","))].join("\n")],{type:"text/csv"}),r=URL.createObjectURL(a),t=document.createElement("a");t.href=r,t.download="".concat(s,".csv"),document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(r)}else if("excel"===a){let a=n.Wp.json_to_sheet(e),r=n.Wp.book_new();n.Wp.book_append_sheet(r,a,"Data");let t=l.map(s=>{let a=Math.max(...e.map(e=>String(e[s]||"").length));return{wch:Math.max(s.length,a,10)}});a["!cols"]=t;let i=new Blob([(e=>{let s=new ArrayBuffer(e.length),a=new Uint8Array(s);for(let s=0;s<e.length;s++)a[s]=255&e.charCodeAt(s);return s})(n.M9(r,{bookType:"xlsx",type:"binary"}))],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=URL.createObjectURL(i),d=document.createElement("a");d.href=c,d.download="".concat(s,".xlsx"),document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(c)}},G=e=>e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br />");return(0,l.jsx)(i.A,{children:(0,l.jsxs)("div",{className:"h-[calc(100vh-8rem)] flex flex-col overflow-hidden",children:[(0,l.jsxs)("div",{className:"mb-6 flex-shrink-0",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold",children:"AI Assistant"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Chat with AI for general questions or ask about real estate data - I'll automatically route your query!"})]}),C&&(0,l.jsx)(f.Fc,{variant:"destructive",className:"mb-4 flex-shrink-0",children:(0,l.jsx)(f.TN,{children:C})}),(0,l.jsxs)("div",{className:"flex gap-6 flex-1 min-h-0 overflow-hidden",children:[(0,l.jsxs)(c.Zp,{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[(0,l.jsx)(c.aR,{className:"flex-shrink-0",children:(0,l.jsxs)(c.ZB,{className:"flex items-center space-x-2 flex-wrap",children:[(0,l.jsx)(N.A,{className:"h-5 w-5 flex-shrink-0"}),(0,l.jsx)("span",{className:"truncate",children:"Partners8 AI Assistant"}),(null==O?void 0:O.available)&&(0,l.jsxs)(p.E,{variant:"secondary",className:"ml-2 flex-shrink-0",children:[(0,l.jsx)(k.A,{className:"h-3 w-3 mr-1"}),null==(e=O.total_rows)?void 0:e.toLocaleString()," records"]})]})}),(0,l.jsxs)(c.Wu,{className:"flex-1 flex flex-col p-0 min-h-0 overflow-hidden",children:[(0,l.jsx)(u,{className:"flex-1 p-4 overflow-hidden",children:(0,l.jsxs)("div",{className:"space-y-6",children:[a.map(e=>(0,l.jsxs)("div",{className:"w-full overflow-hidden",children:[(0,l.jsx)("div",{className:"flex ".concat("user"===e.sender?"justify-end":"justify-start"," w-full"),children:(0,l.jsx)("div",{className:"max-w-[80%] min-w-0 rounded-lg p-3 overflow-hidden ".concat("user"===e.sender?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:(0,l.jsxs)("div",{className:"flex items-start space-x-2 min-w-0",children:["bot"===e.sender&&(0,l.jsx)(N.A,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),"user"===e.sender&&(0,l.jsx)(_.A,{className:"h-4 w-4 mt-0.5 flex-shrink-0 text-blue-100"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0 overflow-hidden",children:["data_query"!==e.queryType&&!e.isGrounded&&"grounded"!==e.queryType&&"grounded_fallback"!==e.queryType&&(0,l.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words overflow-wrap-anywhere",children:e.content}),(0,l.jsxs)("div",{className:"mt-2 flex flex-wrap gap-1",children:["data_query"===e.queryType&&(0,l.jsxs)(p.E,{variant:"default",className:"text-xs",children:[(0,l.jsx)(y.A,{className:"h-3 w-3 mr-1"}),"Data Query"]}),e.isGrounded&&(0,l.jsxs)(p.E,{variant:"secondary",className:"text-xs",children:[(0,l.jsx)(b.A,{className:"h-3 w-3 mr-1"}),"Grounded"]}),"grounded_fallback"===e.queryType&&(0,l.jsx)(p.E,{variant:"outline",className:"text-xs",children:"Search Fallback"})]}),(0,l.jsx)("p",{className:"text-xs mt-2 ".concat("user"===e.sender?"text-blue-100":"text-gray-500"),children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})})}),"data_query"===e.queryType?(e=>{if("data_query"!==e.queryType||!e.queryResults)return null;let s=e.queryResults;if(0===s.length)return(0,l.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg w-full overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,l.jsx)(y.A,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}),(0,l.jsx)(p.E,{variant:"outline",children:"No Data Found"})]}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"No records match your query criteria."})]});let a=Object.keys(s[0]);return(0,l.jsxs)("div",{className:"mt-4 space-y-4 w-full overflow-hidden",children:[(0,l.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[(0,l.jsxs)("div",{className:"border-b border-gray-200 p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 flex-wrap",children:[(0,l.jsx)(j.A,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),(0,l.jsx)(p.E,{variant:"secondary",children:"Query Results"}),(0,l.jsxs)("span",{className:"text-xs text-gray-600",children:[s.length," records"]})]}),(0,l.jsxs)("div",{className:"flex gap-2",children:[(0,l.jsxs)(d.$,{size:"sm",variant:"outline",onClick:()=>z(s,"query_results_".concat(Date.now()),"csv"),className:"text-xs flex-shrink-0",children:[(0,l.jsx)(w.A,{className:"h-3 w-3 mr-1"}),"CSV"]}),(0,l.jsxs)(d.$,{size:"sm",variant:"outline",onClick:()=>z(s,"query_results_".concat(Date.now()),"excel"),className:"text-xs flex-shrink-0",children:[(0,l.jsx)(v.A,{className:"h-3 w-3 mr-1"}),"Excel"]})]})]}),e.sqlQuery&&(0,l.jsxs)("div",{className:"mt-3 bg-gray-100 p-3 rounded text-xs font-mono overflow-hidden",children:[(0,l.jsx)("span",{className:"font-medium text-gray-700",children:"SQL Query:"}),(0,l.jsx)("div",{className:"mt-1 text-gray-600 break-all overflow-wrap-anywhere",children:e.sqlQuery})]})]}),(0,l.jsx)("div",{className:"overflow-x-auto max-h-96",children:(0,l.jsxs)("table",{className:"w-full text-xs min-w-full",children:[(0,l.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,l.jsx)("tr",{children:a.map(e=>(0,l.jsx)("th",{className:"px-3 py-2 text-left font-medium text-gray-700 border-b border-gray-200 whitespace-nowrap",children:e},e))})}),(0,l.jsx)("tbody",{children:s.map((e,s)=>(0,l.jsx)("tr",{className:s%2==0?"bg-white":"bg-gray-50",children:a.map(s=>{var a,r;return(0,l.jsx)("td",{className:"px-3 py-2 border-b border-gray-100 text-gray-800 whitespace-nowrap",children:"number"==typeof e[s]&&(s.toLowerCase().includes("value")||s.toLowerCase().includes("rent")||s.toLowerCase().includes("income"))?"$".concat((null==(a=e[s])?void 0:a.toLocaleString())||0):(null==(r=e[s])?void 0:r.toString())||""},s)})},s))})]})}),s.length>50&&(0,l.jsxs)("div",{className:"text-center py-3 text-xs text-gray-500 bg-gray-50 border-t",children:["Showing all ",s.length," results. Use CSV or Excel export for external analysis."]})]}),e.summary&&e.summary!==e.content&&(0,l.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,l.jsx)(w.A,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}),(0,l.jsx)(p.E,{variant:"default",children:"Data Analysis Summary"})]}),(0,l.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed break-words overflow-wrap-anywhere",dangerouslySetInnerHTML:{__html:G(e.summary)}})]})]})})(e):e.isGrounded||"grounded"===e.queryType||"grounded_fallback"===e.queryType?(0,l.jsxs)("div",{className:"mt-4 space-y-4 w-full overflow-hidden",children:[(0,l.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-3 flex-wrap",children:[(0,l.jsx)(b.A,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),(0,l.jsx)(p.E,{variant:"secondary",children:"Web Search Results"}),"grounded_fallback"===e.queryType&&(0,l.jsx)(p.E,{variant:"outline",className:"text-xs",children:"Fallback Search"})]}),(0,l.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed prose prose-sm max-w-none break-words overflow-wrap-anywhere",dangerouslySetInnerHTML:{__html:G(e.content)}})]}),e.sources&&e.sources.length>0&&(0,l.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-3 flex-wrap",children:[(0,l.jsx)(g.A,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}),(0,l.jsx)(p.E,{variant:"outline",children:"Sources"}),(0,l.jsxs)("span",{className:"text-xs text-gray-600",children:[e.sources.length," references"]})]}),(0,l.jsx)("div",{className:"space-y-2",children:e.sources.map((e,s)=>(0,l.jsxs)("a",{href:e.uri,target:"_blank",rel:"noopener noreferrer",className:"flex items-start space-x-2 p-2 rounded bg-gray-50 hover:bg-gray-100 transition-colors overflow-hidden",children:[(0,l.jsx)(g.A,{className:"h-3 w-3 mt-1 text-blue-600 flex-shrink-0"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0 overflow-hidden",children:[(0,l.jsx)("div",{className:"text-sm font-medium text-blue-600 hover:text-blue-800 truncate",children:e.title}),(0,l.jsx)("div",{className:"text-xs text-gray-500 break-all overflow-wrap-anywhere",children:e.uri})]})]},s))})]})]}):null]},e.id)),R&&(0,l.jsx)("div",{className:"flex justify-start w-full",children:(0,l.jsx)("div",{className:"bg-gray-100 rounded-lg p-3 max-w-[80%] overflow-hidden",children:(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(N.A,{className:"h-4 w-4 flex-shrink-0"}),(0,l.jsxs)("div",{className:"flex space-x-1",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,l.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,l.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),(0,l.jsx)("div",{ref:F})]})}),(0,l.jsx)("div",{className:"border-t p-4 flex-shrink-0",children:(0,l.jsxs)("div",{className:"flex space-x-2 w-full min-w-0",children:[(0,l.jsx)(o.p,{value:m,onChange:e=>h(e.target.value),placeholder:"Ask me anything about real estate data or general questions...",disabled:R,className:"flex-1 min-w-0",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),$(e))}}),(0,l.jsx)(d.$,{onClick:$,disabled:R||!m.trim(),className:"flex-shrink-0",children:(0,l.jsx)(q.A,{className:"h-4 w-4"})})]})})]})]}),(0,l.jsxs)("div",{className:"w-80 flex-shrink-0 space-y-4 overflow-y-auto max-h-full",children:[O&&(0,l.jsxs)(c.Zp,{className:"overflow-hidden",children:[(0,l.jsx)(c.aR,{className:"pb-3",children:(0,l.jsxs)(c.ZB,{className:"text-base flex items-center",children:[(0,l.jsx)(y.A,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,l.jsx)("span",{className:"truncate",children:"Database Status"})]})}),(0,l.jsx)(c.Wu,{className:"space-y-3",children:O.available?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,l.jsx)("span",{children:"Status:"}),(0,l.jsx)(p.E,{variant:"default",children:"Available"})]}),(0,l.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,l.jsx)("span",{children:"Records:"}),(0,l.jsx)("span",{className:"font-medium",children:null==(s=O.total_rows)?void 0:s.toLocaleString()})]}),(0,l.jsx)("div",{className:"text-xs text-gray-600 break-words",children:"Real estate data from Zillow, HUD, and Census sources"})]}):(0,l.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,l.jsx)(p.E,{variant:"secondary",children:"Unavailable"}),(0,l.jsx)("p",{className:"mt-2 break-words",children:O.message})]})})]}),(null==O?void 0:O.available)&&O.sample_queries&&(0,l.jsxs)(c.Zp,{className:"overflow-hidden",children:[(0,l.jsx)(c.aR,{className:"pb-3",children:(0,l.jsx)(c.ZB,{className:"text-base truncate",children:"Sample Queries"})}),(0,l.jsx)(c.Wu,{className:"space-y-2",children:O.sample_queries.map((e,s)=>(0,l.jsx)(d.$,{variant:"outline",size:"sm",className:"w-full text-left justify-start h-auto p-2 text-xs break-words whitespace-normal",onClick:()=>{h(e),I("chat")},children:e},s))})]})]})]})]})})}},3686:()=>{},9852:(e,s,a)=>{"use strict";a.d(s,{p:()=>n});var l=a(5155),r=a(2115),t=a(3999);let n=r.forwardRef((e,s)=>{let{className:a,type:r,...n}=e;return(0,l.jsx)("input",{type:r,className:(0,t.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...n})});n.displayName="Input"}},e=>{e.O(0,[524,711,758,476,321,441,964,358],()=>e(e.s=1981)),_N_E=e.O()}]);