(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{1981:(e,s,a)=>{Promise.resolve().then(a.bind(a,2990))},2383:()=>{},2990:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>E});var t=a(5155),l=a(2115),r=a(5695),n=a(3925),i=a(6643),c=a(8482),o=a(7168),d=a(9852),x=a(7655),u=a(3999);let h=l.forwardRef((e,s)=>{let{className:a,children:l,...r}=e;return(0,t.jsxs)(x.bL,{ref:s,className:(0,u.cn)("relative overflow-hidden",a),...r,children:[(0,t.jsx)(x.LM,{className:"h-full w-full rounded-[inherit]",children:l}),(0,t.jsx)(m,{}),(0,t.jsx)(x.OK,{})]})});h.displayName=x.bL.displayName;let m=l.forwardRef((e,s)=>{let{className:a,orientation:l="vertical",...r}=e;return(0,t.jsx)(x.VM,{ref:s,orientation:l,className:(0,u.cn)("flex touch-none select-none transition-colors","vertical"===l&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===l&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...r,children:(0,t.jsx)(x.lr,{className:"relative flex-1 rounded-full bg-border"})})});m.displayName=x.VM.displayName;var f=a(9026),p=a(8145),y=a(4213),w=a(5112),g=a(7434),v=a(4261),j=a(7924),b=a(3786),N=a(5657),k=a(2713),_=a(1007),q=a(2486),A=a(4938);let S=e=>{var s;let a="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===a.length&&(null==(s=a.pop())?void 0:s.split(";").shift())||null},R=e=>{document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;")};function E(){var e,s;let[a,x]=(0,l.useState)([]),[u,m]=(0,l.useState)(""),[E,L]=(0,l.useState)(!1),[T,C]=(0,l.useState)(""),[D,U]=(0,l.useState)(null),[I,O]=(0,l.useState)("chat"),[F,M]=(0,l.useState)(null),B=(0,l.useRef)(null),P=(0,r.useRouter)();(0,l.useEffect)(()=>{if(!S("access_token"))return void P.push("/");W(),x([{id:"welcome",content:"Hello! I'm your Partners8 AI assistant. I can help you with both general questions and real estate data analysis. Try asking me about property data, or just chat with me about anything!",sender:"bot",timestamp:new Date}])},[P]),(0,l.useEffect)(()=>{Q()},[a]);let Q=()=>{var e;null==(e=B.current)||e.scrollIntoView({behavior:"smooth"})},z=()=>{R("access_token"),R("username"),R("user_role"),R("user_id"),R("user_email")},W=async()=>{try{let e=S("access_token");if(!e){z(),P.push("/");return}let s=await A.u.get("/database/info",{headers:{Authorization:"Bearer ".concat(e)}});M(s)}catch(e){console.error("Failed to load database info:",e),e.message&&e.message.includes("401")&&(z(),P.push("/"))}},Z=async e=>{if(e.preventDefault(),!u.trim()||E)return;let s={id:Date.now().toString(),content:u,sender:"user",timestamp:new Date};x(e=>[...e,s]),m(""),L(!0),C("");try{let e=S("access_token");if(!e){z(),P.push("/");return}let s=await A.u.post("/chat",{message:u,session_id:D},{Authorization:"Bearer ".concat(e)});D||U(s.session_id);let a="",t=s.response;if("data_query"===s.query_type&&s.response.includes("**Data Analysis Results:**")){let e=s.response.split("**Data Analysis Results:**");e.length>1&&(t=a=e[1].split("**Found")[0].trim().replace(/\n\n/g," ").trim())}let l={id:(Date.now()+1).toString(),content:t,sender:"bot",timestamp:new Date,isGrounded:s.is_grounded,sources:s.sources,sessionId:s.session_id,queryType:s.query_type,sqlQuery:s.sql_query,queryResults:s.query_results,summary:a||t};x(e=>[...e,l])}catch(e){console.error("Failed to send message:",e),e.message&&e.message.includes("401")?(z(),P.push("/")):C(e.message||"Failed to send message")}finally{L(!1)}},$=function(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"csv";if(!e||0===e.length)return;let t=Object.keys(e[0]);if("csv"===a){let a=new Blob([[t.join(","),...e.map(e=>t.map(s=>{let a=e[s];return"string"==typeof a&&(a.includes(",")||a.includes('"'))?'"'.concat(a.replace(/"/g,'""'),'"'):a||""}).join(","))].join("\n")],{type:"text/csv"}),l=URL.createObjectURL(a),r=document.createElement("a");r.href=l,r.download="".concat(s,".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(l)}else if("excel"===a){let a=n.Wp.json_to_sheet(e),l=n.Wp.book_new();n.Wp.book_append_sheet(l,a,"Data");let r=t.map(s=>{let a=Math.max(...e.map(e=>String(e[s]||"").length));return{wch:Math.max(s.length,a,10)}});a["!cols"]=r;let i=new Blob([(e=>{let s=new ArrayBuffer(e.length),a=new Uint8Array(s);for(let s=0;s<e.length;s++)a[s]=255&e.charCodeAt(s);return s})(n.M9(l,{bookType:"xlsx",type:"binary"}))],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c=URL.createObjectURL(i),o=document.createElement("a");o.href=c,o.download="".concat(s,".xlsx"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(c)}},G=e=>e.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\n/g,"<br />");return(0,t.jsx)(i.A,{children:(0,t.jsxs)("div",{className:"h-[calc(100vh-8rem)] flex flex-col overflow-hidden",children:[(0,t.jsxs)("div",{className:"mb-6 flex-shrink-0",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"AI Assistant"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Chat with AI for general questions or ask about real estate data - I'll automatically route your query!"})]}),T&&(0,t.jsx)(f.Fc,{variant:"destructive",className:"mb-4 flex-shrink-0",children:(0,t.jsx)(f.TN,{children:T})}),(0,t.jsxs)("div",{className:"flex gap-6 flex-1 min-h-0 overflow-hidden",children:[(0,t.jsxs)(c.Zp,{className:"flex-1 flex flex-col min-w-0 overflow-hidden",children:[(0,t.jsx)(c.aR,{className:"flex-shrink-0",children:(0,t.jsxs)(c.ZB,{className:"flex items-center space-x-2 flex-wrap",children:[(0,t.jsx)(N.A,{className:"h-5 w-5 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:"Partners8 AI Assistant"}),(null==F?void 0:F.available)&&(0,t.jsxs)(p.E,{variant:"secondary",className:"ml-2 flex-shrink-0",children:[(0,t.jsx)(k.A,{className:"h-3 w-3 mr-1"}),null==(e=F.total_rows)?void 0:e.toLocaleString()," records"]})]})}),(0,t.jsxs)(c.Wu,{className:"flex-1 flex flex-col p-0 min-h-0 overflow-hidden",children:[(0,t.jsx)(h,{className:"flex-1 p-4 overflow-hidden",children:(0,t.jsxs)("div",{className:"space-y-6",children:[a.map(e=>(0,t.jsxs)("div",{className:"w-full overflow-hidden",children:[(0,t.jsx)("div",{className:"flex ".concat("user"===e.sender?"justify-end":"justify-start"," w-full"),children:(0,t.jsx)("div",{className:"max-w-[80%] min-w-0 rounded-lg p-3 overflow-hidden ".concat("user"===e.sender?"bg-blue-600 text-white":"bg-gray-100 text-gray-900"),children:(0,t.jsxs)("div",{className:"flex items-start space-x-2 min-w-0",children:["bot"===e.sender&&(0,t.jsx)(N.A,{className:"h-4 w-4 mt-0.5 flex-shrink-0"}),"user"===e.sender&&(0,t.jsx)(_.A,{className:"h-4 w-4 mt-0.5 flex-shrink-0 text-blue-100"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0 overflow-hidden",children:["data_query"!==e.queryType&&!e.isGrounded&&"grounded"!==e.queryType&&"grounded_fallback"!==e.queryType&&(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words overflow-wrap-anywhere",children:e.content}),(0,t.jsxs)("div",{className:"mt-2 flex flex-wrap gap-1",children:["data_query"===e.queryType&&(0,t.jsxs)(p.E,{variant:"default",className:"text-xs",children:[(0,t.jsx)(y.A,{className:"h-3 w-3 mr-1"}),"Data Query"]}),e.isGrounded&&(0,t.jsxs)(p.E,{variant:"secondary",className:"text-xs",children:[(0,t.jsx)(j.A,{className:"h-3 w-3 mr-1"}),"Grounded"]}),"grounded_fallback"===e.queryType&&(0,t.jsx)(p.E,{variant:"outline",className:"text-xs",children:"Search Fallback"})]}),(0,t.jsx)("p",{className:"text-xs mt-2 ".concat("user"===e.sender?"text-blue-100":"text-gray-500"),children:e.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]})})}),"data_query"===e.queryType?(e=>{if("data_query"!==e.queryType||!e.queryResults)return null;let s=e.queryResults;if(0===s.length)return(0,t.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg w-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,t.jsx)(y.A,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}),(0,t.jsx)(p.E,{variant:"outline",children:"No Data Found"})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"No records match your query criteria."})]});let a=Object.keys(s[0]);return(0,t.jsxs)("div",{className:"mt-4 space-y-4 w-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[(0,t.jsxs)("div",{className:"border-b border-gray-200 p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between flex-wrap gap-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 flex-wrap",children:[(0,t.jsx)(w.A,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),(0,t.jsx)(p.E,{variant:"secondary",children:"Query Results"}),(0,t.jsxs)("span",{className:"text-xs text-gray-600",children:[s.length," records"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(o.$,{size:"sm",variant:"outline",onClick:()=>$(s,"query_results_".concat(Date.now()),"csv"),className:"text-xs flex-shrink-0",children:[(0,t.jsx)(g.A,{className:"h-3 w-3 mr-1"}),"CSV"]}),(0,t.jsxs)(o.$,{size:"sm",variant:"outline",onClick:()=>$(s,"query_results_".concat(Date.now()),"excel"),className:"text-xs flex-shrink-0",children:[(0,t.jsx)(v.A,{className:"h-3 w-3 mr-1"}),"Excel"]})]})]}),e.sqlQuery&&(0,t.jsxs)("div",{className:"mt-3 bg-gray-100 p-3 rounded text-xs font-mono overflow-hidden",children:[(0,t.jsx)("span",{className:"font-medium text-gray-700",children:"SQL Query:"}),(0,t.jsx)("div",{className:"mt-1 text-gray-600 break-all overflow-wrap-anywhere",children:e.sqlQuery})]})]}),(0,t.jsx)("div",{className:"overflow-x-auto max-h-96",children:(0,t.jsxs)("table",{className:"w-full text-xs min-w-full",children:[(0,t.jsx)("thead",{className:"bg-gray-50 sticky top-0",children:(0,t.jsx)("tr",{children:a.map(e=>(0,t.jsx)("th",{className:"px-3 py-2 text-left font-medium text-gray-700 border-b border-gray-200 whitespace-nowrap",children:e},e))})}),(0,t.jsx)("tbody",{children:s.map((e,s)=>(0,t.jsx)("tr",{className:s%2==0?"bg-white":"bg-gray-50",children:a.map(s=>{var a,l;return(0,t.jsx)("td",{className:"px-3 py-2 border-b border-gray-100 text-gray-800 whitespace-nowrap",children:"number"==typeof e[s]&&(s.toLowerCase().includes("value")||s.toLowerCase().includes("rent")||s.toLowerCase().includes("income"))?"$".concat((null==(a=e[s])?void 0:a.toLocaleString())||0):(null==(l=e[s])?void 0:l.toString())||""},s)})},s))})]})}),s.length>50&&(0,t.jsxs)("div",{className:"text-center py-3 text-xs text-gray-500 bg-gray-50 border-t",children:["Showing all ",s.length," results. Use CSV or Excel export for external analysis."]})]}),e.summary&&e.summary!==e.content&&(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,t.jsx)(g.A,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}),(0,t.jsx)(p.E,{variant:"default",children:"Data Analysis Summary"})]}),(0,t.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed break-words overflow-wrap-anywhere",dangerouslySetInnerHTML:{__html:G(e.summary)}})]})]})})(e):e.isGrounded||"grounded"===e.queryType||"grounded_fallback"===e.queryType?(0,t.jsxs)("div",{className:"mt-4 space-y-4 w-full overflow-hidden",children:[(0,t.jsxs)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-3 flex-wrap",children:[(0,t.jsx)(j.A,{className:"h-4 w-4 text-green-600 flex-shrink-0"}),(0,t.jsx)(p.E,{variant:"secondary",children:"Web Search Results"}),"grounded_fallback"===e.queryType&&(0,t.jsx)(p.E,{variant:"outline",className:"text-xs",children:"Fallback Search"})]}),(0,t.jsx)("div",{className:"text-sm text-gray-800 leading-relaxed prose prose-sm max-w-none break-words overflow-wrap-anywhere",dangerouslySetInnerHTML:{__html:G(e.content)}})]}),e.sources&&e.sources.length>0&&(0,t.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-4 overflow-hidden",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-3 flex-wrap",children:[(0,t.jsx)(b.A,{className:"h-4 w-4 text-blue-600 flex-shrink-0"}),(0,t.jsx)(p.E,{variant:"outline",children:"Sources"}),(0,t.jsxs)("span",{className:"text-xs text-gray-600",children:[e.sources.length," references"]})]}),(0,t.jsx)("div",{className:"space-y-2",children:e.sources.map((e,s)=>(0,t.jsxs)("a",{href:e.uri,target:"_blank",rel:"noopener noreferrer",className:"flex items-start space-x-2 p-2 rounded bg-gray-50 hover:bg-gray-100 transition-colors overflow-hidden",children:[(0,t.jsx)(b.A,{className:"h-3 w-3 mt-1 text-blue-600 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0 overflow-hidden",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-blue-600 hover:text-blue-800 truncate",children:e.title}),(0,t.jsx)("div",{className:"text-xs text-gray-500 break-all overflow-wrap-anywhere",children:e.uri})]})]},s))})]})]}):null]},e.id)),E&&(0,t.jsx)("div",{className:"flex justify-start w-full",children:(0,t.jsx)("div",{className:"bg-gray-100 rounded-lg p-3 max-w-[80%] overflow-hidden",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(N.A,{className:"h-4 w-4 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex space-x-1",children:[(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,t.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})}),(0,t.jsx)("div",{ref:B})]})}),(0,t.jsx)("div",{className:"border-t p-4 flex-shrink-0",children:(0,t.jsxs)("div",{className:"flex space-x-2 w-full min-w-0",children:[(0,t.jsx)(d.p,{value:u,onChange:e=>m(e.target.value),placeholder:"Ask me anything about real estate data or general questions...",disabled:E,className:"flex-1 min-w-0",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Z(e))}}),(0,t.jsx)(o.$,{onClick:Z,disabled:E||!u.trim(),className:"flex-shrink-0",children:(0,t.jsx)(q.A,{className:"h-4 w-4"})})]})})]})]}),(0,t.jsxs)("div",{className:"w-80 flex-shrink-0 space-y-4 overflow-y-auto max-h-full",children:[F&&(0,t.jsxs)(c.Zp,{className:"overflow-hidden",children:[(0,t.jsx)(c.aR,{className:"pb-3",children:(0,t.jsxs)(c.ZB,{className:"text-base flex items-center",children:[(0,t.jsx)(y.A,{className:"h-4 w-4 mr-2 flex-shrink-0"}),(0,t.jsx)("span",{className:"truncate",children:"Database Status"})]})}),(0,t.jsx)(c.Wu,{className:"space-y-3",children:F.available?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{children:"Status:"}),(0,t.jsx)(p.E,{variant:"default",children:"Available"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{children:"Records:"}),(0,t.jsx)("span",{className:"font-medium",children:null==(s=F.total_rows)?void 0:s.toLocaleString()})]}),(0,t.jsx)("div",{className:"text-xs text-gray-600 break-words",children:"Real estate data from Zillow, HUD, and Census sources"})]}):(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,t.jsx)(p.E,{variant:"secondary",children:"Unavailable"}),(0,t.jsx)("p",{className:"mt-2 break-words",children:F.message})]})})]}),(null==F?void 0:F.available)&&F.sample_queries&&(0,t.jsxs)(c.Zp,{className:"overflow-hidden",children:[(0,t.jsx)(c.aR,{className:"pb-3",children:(0,t.jsx)(c.ZB,{className:"text-base truncate",children:"Sample Queries"})}),(0,t.jsx)(c.Wu,{className:"space-y-2",children:F.sample_queries.map((e,s)=>(0,t.jsx)(o.$,{variant:"outline",size:"sm",className:"w-full text-left justify-start h-auto p-2 text-xs break-words whitespace-normal",onClick:()=>{m(e),O("chat")},children:e},s))})]})]})]})]})})}},3686:()=>{},4938:(e,s,a)=>{"use strict";a.d(s,{u:()=>l});class t{async request(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r="".concat(this.baseURL).concat(s),n={method:e,headers:{"Content-Type":"application/json",...t}};a&&(n.body=JSON.stringify(a));let i="".concat(e,"-").concat(r,"-").concat(JSON.stringify(a));if(l&&this.cache.has(i))return console.log("Cache hit for ".concat(i)),this.cache.get(i);try{let e=await fetch(r,n);if(!e.ok){let s=await e.json().catch(()=>({detail:e.statusText}));throw Error(s.detail||"API Error: ".concat(e.status))}let s=await e.json();return l&&this.cache.set(i,s),s}catch(s){throw console.error("API Request Error (".concat(e," ").concat(r,"):"),s),s}}get(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.request("GET",e,null,s,a)}post(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("POST",e,s,a)}put(e,s){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.request("PUT",e,s,a)}delete(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.request("DELETE",e,null,s)}constructor(){this.baseURL=function(){let e=window.location.hostname;window.location.port;let s=window.location.protocol;return"localhost"===e||"127.0.0.1"===e?"http://localhost:8000":"".concat(s,"//").concat(e,":8000")}(),this.cache=new Map,console.log("API Client initialized with base URL: ".concat(this.baseURL))}}let l=new t},9852:(e,s,a)=>{"use strict";a.d(s,{p:()=>n});var t=a(5155),l=a(2115),r=a(3999);let n=l.forwardRef((e,s)=>{let{className:a,type:l,...n}=e;return(0,t.jsx)("input",{type:l,className:(0,r.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),ref:s,...n})});n.displayName="Input"}},e=>{e.O(0,[524,711,758,476,321,441,964,358],()=>e(e.s=1981)),_N_E=e.O()}]);