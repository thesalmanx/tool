(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[669],{646:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(9946).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},6949:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>S});var a=t(5155),r=t(2115),l=t(5695),c=t(6643),n=t(8482),i=t(7168),d=t(8145),o=t(9026),u=t(8524),h=t(3999);let x=r.forwardRef((e,s)=>{let{className:t,value:r,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,h.cn)("relative h-2 w-full overflow-hidden rounded-full bg-gray-200",t),...l,children:(0,a.jsx)("div",{className:"h-full w-full flex-1 bg-blue-600 transition-all duration-300 ease-in-out",style:{transform:"translateX(-".concat(100-(r||0),"%)")}})})});x.displayName="Progress";var m=t(9946);let p=(0,m.A)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),j=(0,m.A)("pause",[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]]);var g=t(646);let f=(0,m.A)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]),N=(0,m.A)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),y=(0,m.A)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var v=t(5690);let b=(0,m.A)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),w=(0,m.A)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),_=e=>{var s;let t="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===t.length&&(null==(s=t.pop())?void 0:s.split(";").shift())||null},k=e=>{document.cookie="".concat(e,"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;")};function S(){let[e,s]=(0,r.useState)({status:"idle"}),[t,h]=(0,r.useState)([]),[m,S]=(0,r.useState)(1),[A,R]=(0,r.useState)(1),[C,T]=(0,r.useState)(!1),[z,B]=(0,r.useState)(""),[D,M]=(0,r.useState)(""),[F,P]=(0,r.useState)(!1),L=(0,l.useRouter)();(0,r.useEffect)(()=>{let s=_("access_token"),t=_("user_role");if(!s||"admin"!==t)return void L.push("/dashboard");E(),H();let a=setInterval(()=>{E(),("completed"===e.status||"failed"===e.status)&&H()},3e3);return()=>clearInterval(a)},[L,e.status]);let Z=()=>{k("access_token"),k("username"),k("user_role"),k("user_id"),k("user_email")},E=async()=>{try{let e=_("access_token"),t=await fetch("http://localhost:8000/scraping_status",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();s(e),P("paused"===e.status)}else 401===t.status&&(Z(),L.push("/"))}catch(e){console.error("Failed to fetch status:",e)}},H=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m;try{let s=_("access_token"),t=await fetch("http://localhost:8000/scraping_logs?page=".concat(e,"&limit=").concat(10),{headers:{Authorization:"Bearer ".concat(s)}});if(t.ok){let e=await t.json();h(e.logs),R(Math.ceil(e.total/10)),S(e.page)}else 401===t.status&&(Z(),L.push("/"))}catch(e){console.error("Failed to fetch logs:",e)}},$=async()=>{T(!0),B(""),M("");try{let e=_("access_token"),s=await fetch("http://localhost:8000/start_scraping",{method:"POST",headers:{Authorization:"Bearer ".concat(e)}});if(s.ok)M("Scraping started successfully"),E(),H(),setTimeout(()=>M(""),3e3);else if(401===s.status)Z(),L.push("/");else{let e=await s.json();B(e.detail||"Failed to start scraping")}}catch(e){B("Network error")}finally{T(!1)}},q=async()=>{T(!0),B(""),M("");try{let e=_("access_token"),s=await fetch("http://localhost:8000/stop_scraping",{method:"POST",headers:{Authorization:"Bearer ".concat(e)}});if(s.ok)M("Stop signal sent successfully"),E(),H(),setTimeout(()=>M(""),3e3);else if(401===s.status)Z(),L.push("/");else{let e=await s.json();B(e.detail||"Failed to stop scraping")}}catch(e){B("Network error")}finally{T(!1)}},I=e=>{switch(e){case"running":case"completed":return"default";case"paused":case"stopped":default:return"secondary";case"failed":return"destructive"}},O=e=>{switch(e){case"running":return(0,a.jsx)(p,{className:"h-4 w-4 animate-pulse text-green-500"});case"paused":return(0,a.jsx)(j,{className:"h-4 w-4 text-yellow-500"});case"completed":return(0,a.jsx)(g.A,{className:"h-4 w-4 text-green-500"});case"failed":return(0,a.jsx)(f,{className:"h-4 w-4 text-red-500"});case"stopped":return(0,a.jsx)(N,{className:"h-4 w-4 text-orange-500"});default:return(0,a.jsx)(y,{className:"h-4 w-4 text-gray-500"})}},U=()=>e.current_step&&e.total_steps?e.current_step/e.total_steps*100:0;return(0,a.jsx)(c.A,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Scraping Control"})}),z&&(0,a.jsx)(o.Fc,{variant:"destructive",children:(0,a.jsx)(o.TN,{children:z})}),D&&(0,a.jsx)(o.Fc,{children:(0,a.jsx)(o.TN,{children:D})}),(0,a.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"flex items-center space-x-2",children:[O(e.status),(0,a.jsx)("span",{children:"Current Status"})]}),(0,a.jsx)(n.BT,{children:"Real-time scraping process status with progress tracking"})]}),(0,a.jsx)(n.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Status:"}),(0,a.jsx)(d.E,{variant:I(e.status),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]}),"running"===e.status&&e.current_step&&e.total_steps&&(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,a.jsx)("span",{children:"Progress"}),(0,a.jsxs)("span",{children:[e.current_step,"/",e.total_steps," steps"]})]}),(0,a.jsx)(x,{value:U(),className:"w-full"}),e.step_name&&(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["Current: ",e.step_name]})]}),e.started_at&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Started:"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:new Date(e.started_at).toLocaleString()})]}),e.completed_at&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Completed:"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:new Date(e.completed_at).toLocaleString()})]}),void 0!==e.records_processed&&e.records_processed>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Records Processed:"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.records_processed.toLocaleString()})]}),e.error_message&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"text-sm font-medium text-red-600",children:"Error:"}),(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:e.error_message})]}),("running"===e.status||"paused"===e.status)&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Pipeline Steps:"}),(0,a.jsx)("div",{className:"mt-2 space-y-1",children:["Download Zillow Data","Merge Zillow Data","Fetch HUD Data","Fetch NAR Data","Calculate Ratios","Save Final Data"].map((s,t)=>(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-xs p-2 rounded ".concat(e.current_step&&t+1===e.current_step?"bg-blue-50 border border-blue-200":e.current_step&&t+1<e.current_step?"bg-green-50 border border-green-200":"bg-gray-50"),children:[(0,a.jsx)("span",{className:"w-5 h-5 rounded-full flex items-center justify-center text-xs ".concat(e.current_step&&t+1===e.current_step?"bg-blue-500 text-white":e.current_step&&t+1<e.current_step?"bg-green-500 text-white":"bg-gray-300 text-gray-600"),children:t+1<(e.current_step||0)?"âœ“":t+1}),(0,a.jsx)("span",{className:e.current_step&&t+1===e.current_step?"font-medium text-blue-700":e.current_step&&t+1<e.current_step?"text-green-700":"text-gray-600",children:s})]},t))})]})]})})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{children:"Enhanced Controls"}),(0,a.jsx)(n.BT,{children:"Start, stop, pause, or resume the scraping process"})]}),(0,a.jsx)(n.Wu,{children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(i.$,{onClick:$,disabled:C||"running"===e.status||"paused"===e.status,className:"w-full",variant:"running"===e.status?"secondary":"default",children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"running"===e.status||"paused"===e.status?"Pipeline Active":"Start Scraping"]}),(0,a.jsxs)(i.$,{onClick:q,disabled:C||"running"!==e.status&&"paused"!==e.status,variant:"destructive",className:"w-full",children:[(0,a.jsx)(y,{className:"h-4 w-4 mr-2"}),"Stop Pipeline"]}),(0,a.jsxs)(i.$,{onClick:()=>{E(),H()},variant:"outline",className:"w-full bg-transparent",disabled:C,children:[(0,a.jsx)(b,{className:"h-4 w-4 mr-2"}),"Refresh Status"]})]})})]})]}),(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsx)(n.ZB,{children:"Scraping History"}),(0,a.jsx)(n.BT,{children:"Recent scraping operations and their results"})]}),(0,a.jsx)(n.Wu,{children:t.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(u.XI,{children:[(0,a.jsx)(u.A0,{children:(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nd,{children:"Status"}),(0,a.jsx)(u.nd,{children:"Started"}),(0,a.jsx)(u.nd,{children:"Completed"}),(0,a.jsx)(u.nd,{children:"Records"}),(0,a.jsx)(u.nd,{children:"Duration"}),(0,a.jsx)(u.nd,{children:"Details"})]})}),(0,a.jsx)(u.BF,{children:t.map(e=>(0,a.jsxs)(u.Hj,{children:[(0,a.jsx)(u.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[O(e.status),(0,a.jsx)(d.E,{variant:I(e.status),children:e.status.charAt(0).toUpperCase()+e.status.slice(1)})]})}),(0,a.jsx)(u.nA,{children:new Date(e.started_at).toLocaleString()}),(0,a.jsx)(u.nA,{children:e.completed_at?new Date(e.completed_at).toLocaleString():"-"}),(0,a.jsx)(u.nA,{children:e.records_processed?e.records_processed.toLocaleString():"0"}),(0,a.jsx)(u.nA,{children:e.completed_at?"".concat(Math.round((new Date(e.completed_at).getTime()-new Date(e.started_at).getTime())/1e3),"s"):"-"}),(0,a.jsx)(u.nA,{children:e.error_message&&(0,a.jsx)("span",{className:"text-xs text-red-600 truncate max-w-xs",title:e.error_message,children:e.error_message.length>50?"".concat(e.error_message.substring(0,50),"..."):e.error_message})})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-4",children:[(0,a.jsx)(i.$,{onClick:()=>H(m-1),disabled:1===m||C,variant:"outline",size:"sm",children:"Previous"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["Page ",m," of ",A]}),(0,a.jsx)(i.$,{onClick:()=>H(m+1),disabled:m===A||C,variant:"outline",size:"sm",children:"Next"})]})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(w,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"No scraping history available"}),(0,a.jsx)("p",{className:"text-sm mt-2",children:"Start your first scraping operation to see logs here"})]})})]}),"running"===e.status&&(0,a.jsxs)(n.Zp,{children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"flex items-center space-x-2",children:[(0,a.jsx)(p,{className:"h-5 w-5 animate-pulse text-green-500"}),(0,a.jsx)("span",{children:"Live Activity Monitor"})]}),(0,a.jsx)(n.BT,{children:"Real-time pipeline activity and progress"})]}),(0,a.jsx)(n.Wu,{children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Pipeline Status"}),(0,a.jsxs)(d.E,{variant:"default",className:"animate-pulse",children:[(0,a.jsx)(p,{className:"h-3 w-3 mr-1"}),"Active"]})]}),e.current_step&&e.total_steps&&(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-blue-800",children:"Current Step"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-blue-600",children:[e.current_step," / ",e.total_steps]})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-3 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm font-medium text-green-800",children:"Progress"}),(0,a.jsxs)("div",{className:"text-lg font-bold text-green-600",children:[Math.round(U()),"%"]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsx)("div",{className:"text-sm font-medium mb-2",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)(i.$,{size:"sm",variant:"outline",onClick:q,disabled:C,children:[(0,a.jsx)(y,{className:"h-3 w-3 mr-1"}),"Stop"]}),(0,a.jsxs)(i.$,{size:"sm",variant:"outline",onClick:E,disabled:C,children:[(0,a.jsx)(b,{className:"h-3 w-3 mr-1"}),"Refresh"]})]})]})]})})]})]})})}},8524:(e,s,t)=>{"use strict";t.d(s,{A0:()=>n,BF:()=>i,Hj:()=>d,XI:()=>c,nA:()=>u,nd:()=>o});var a=t(5155),r=t(2115),l=t(3999);let c=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{className:"relative w-full overflow-auto",children:(0,a.jsx)("table",{ref:s,className:(0,l.cn)("w-full caption-bottom text-sm",t),...r})})});c.displayName="Table";let n=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("thead",{ref:s,className:(0,l.cn)("[&_tr]:border-b",t),...r})});n.displayName="TableHeader";let i=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tbody",{ref:s,className:(0,l.cn)("[&_tr:last-child]:border-0",t),...r})});i.displayName="TableBody",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tfoot",{ref:s,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",t),...r})}).displayName="TableFooter";let d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("tr",{ref:s,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...r})});d.displayName="TableRow";let o=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("th",{ref:s,className:(0,l.cn)("h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})});o.displayName="TableHead";let u=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("td",{ref:s,className:(0,l.cn)("p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...r})});u.displayName="TableCell",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("caption",{ref:s,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",t),...r})}).displayName="TableCaption"},9986:(e,s,t)=>{Promise.resolve().then(t.bind(t,6949))}},e=>{e.O(0,[711,758,321,441,964,358],()=>e(e.s=9986)),_N_E=e.O()}]);